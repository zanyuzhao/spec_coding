# Spec 自动触发

根据用户**当前这句话的意图**决定是否走 Spec 流程，用户不需要知道「要先写 spec」或项目流程。

## 必须触发 Spec 流程的意图

### 新功能 / 修改既有功能（仅产出文档，然后停止）

用户在做以下任一表述时，**自动**进入 Spec 流程的**文档阶段**（不写代码）：

- **新功能**：如「加一个登录」「做个订单列表」「支持导出 Excel」。
- **修改既有功能/行为**：如「把登录改成支持手机号」「订单列表要分页」「导出改成 CSV 也要支持」。

**触发后你必须**：
1. 先列出现有 `docs/spec/active/` 避免重复或冲突。
2. 在 `docs/spec/active/` 下创建或更新对应 spec，产出**需求说明文档**与**设计文档**（结构见 `spec_manager.md` 与 `docs/spec_process/SPEC_DOC_TEMPLATE.md`）。
3. **然后停止**：回复中说明「已写好需求说明与设计文档，请查看 `docs/spec/active/` 下 [文件名]。确认无误或修改后，说「继续开发」我再按文档实现。」**不得**在未获用户确认前自动开始写 backend/frontend 代码。

### 继续开发（用户确认文档后）

当用户**已看过或修改过**需求/设计文档，并明确要求进入实现时，才执行开发：

- **视为「继续开发」的表述**：如「继续开发」「按文档开发」「文档没问题，开始实现」「就按这个做」「开始实现」。
- **此时你才**：按 `docs/spec/active/` 下该需求的 spec 与设计文档，实现或修改 backend/frontend，并按开发清单与验收执行。

## 不触发 Spec 流程的意图

以下情况**不要**走 Spec 流程，直接响应即可：

- **修 Bug**：如「这里报错」「登录后跳转错了」「列表不刷新」——直接改代码，不新建/不强制改 spec。
- **提问/解释**：如「这段是干啥的」「OpenSpec 是什么」「怎么部署」——直接回答，不写 spec。
- **设计/流程讨论**：如「帮忙设计鉴权方案」「评估一下用 Redis 还是 DB」——只讨论或给建议，不视为「要实现新功能」时不写 spec；若用户随后明确说「就按这个做」，再触发 spec 并实现。
- **重构/代码质量**：如「把这段抽成函数」「加类型」「修 lint」且未改变对外行为——不触发；若涉及对外接口或行为变更，则触发。

## 归档触发（仅限用户明确说出）

**只有**用户**明确**说出要归档时，才执行归档流程（校验 → 完善文档 → 合并 delta → 移入 archive → 清理）。不做任何自动推断——不根据「下一个需求」「谢谢」「做完了」等猜测用户要归档。

**视为明确归档的表述**：如「归档」「开发完成」「当前需求归档」「把 [需求名] 归档」「需求收尾」。

## 判断不清时

若无法从当前一句判断是「新功能/改需求」还是「修 bug/提问」：先按**不触发**处理，直接回应；若用户补充说要做成正式功能或改产品行为，再补走 Spec 流程并说明已补录需求。
